<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>I Love Lamp – Frosted Glass Widget (iCUE-safe)</title>
  <style>
    :root{
      --glow-r: 255; --glow-g: 184; --glow-b: 79;
      --brightness: 70;
      --glow-deg: 90deg;
      --rib-opacity: 0.25;
      --rib-angle: 90deg;
      --bg-color:#121212; --text-color:#e9e9e9; --panel-bg:#1e1e1e; --muted:#b7b7b7;
      --edge-dark: 24,24,28; --glass-tint: 255,255,255;
      --noise-opacity:.08; --corner: 28px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; margin:0; }
    body{
      background:var(--bg-color); color:var(--text-color);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
      transition: background .3s ease, color .3s ease;
    }
    body.light{ --bg-color:#e9e6e3; --text-color:#1f2328; --panel-bg:#ffffff; --muted:#59636e; }

    .page{ position:relative; height:100%; }

    .frame{ position:absolute; inset:0; border-radius:var(--corner); overflow:hidden; background:transparent; }

    .glass{ position:absolute; inset:0; border-radius:inherit; background:
      radial-gradient(120% 100% at -10% 50%, rgba(var(--edge-dark), .18), transparent 45%),
      radial-gradient(120% 100% at 110% 50%, rgba(var(--edge-dark), .18), transparent 45%),
      linear-gradient(180deg, rgba(var(--glass-tint),.5), rgba(var(--glass-tint),.35)); }

    .ribs{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; background:
      repeating-linear-gradient(var(--rib-angle), rgba(255,255,255, calc(var(--rib-opacity)*.35)) 0 1px,
      rgba(200,200,210, calc(var(--rib-opacity)*.35)) 1px 2px, rgba(150,150,160,0) 2px 5px); opacity:.9; }

    .grain{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; }
    .grain::before{ content:""; position:absolute; inset:-50%; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.45"/></svg>'); background-size:300px 300px; opacity:var(--noise-opacity); mix-blend-mode:soft-light; }

    .glow{ position:absolute; inset: clamp(6px, 7vmin, 64px); border-radius: calc(var(--corner)*.6);
      filter: blur(calc(8px + (var(--brightness)/100 * 18px)));
      background:
        radial-gradient(closest-side at 50% 50%, rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/85)) 0%, rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/140)) 55%, rgba(var(--glow-r), var(--glow-g), var(--glow-b), 0) 100%),
        radial-gradient(120% 120% at 50% 50%, rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/220)) 0%, rgba(0,0,0,0) 70%),
        linear-gradient(var(--glow-deg), rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/300)) 35%, rgba(0,0,0,0) 65%);
      box-shadow:
        0 0 calc(25px + 55px * (var(--brightness)/100)) rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/130)),
        0 0 calc(60px + 120px * (var(--brightness)/100)) rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/320));
      mix-blend-mode: screen;
    }

    .glass::after{ content:""; position:absolute; inset:0; border-radius:inherit; background: linear-gradient(180deg, rgba(255,255,255,.45), rgba(255,255,255,0) 28%, rgba(0,0,0,.06) 65%, rgba(0,0,0,.14)); mix-blend-mode:screen; opacity:.85; }

    .panel{ position:fixed; right:20px; top:20px; bottom:20px; width: clamp(260px, 26vw, 380px); z-index:5;
      background:var(--panel-bg); border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1);
      display:flex; flex-direction:column; padding:14px; gap:12px; transform: translateX(0); transition: transform .35s ease; overflow:hidden; }

    /* Keep title clear of the collapse arrow */
    .panel h2 { margin-left: 28px; }

    .panel.collapsed{ transform: translateX(calc(100% + 24px)); }
    .panel-scroll{ overflow:auto; padding:6px 2px 10px; }

    .collapse-btn{ position:absolute; left:10px; top:10px; border:0; border-radius:8px; padding:6px 10px; font-weight:700; cursor:pointer; background:#2c2c2c; color:#fff; z-index:10; }
    body.light .collapse-btn{ background:#e1e1e1; color:#111; }

    .menu-tab{ position:fixed; right:12px; top:50%; transform:translateY(-50%); border:0; border-radius:12px; padding:10px 12px; font-weight:700; cursor:pointer; background:#2c2c2c; color:#fff; box-shadow:0 8px 20px rgba(0,0,0,.25); display:none; z-index:6; }
    .panel.collapsed + .menu-tab{ display:block; }
    body.light .menu-tab{ background:#e1e1e1; color:#111; }

    .toggle-btn{ cursor:pointer; border:none; border-radius:8px; padding:8px 12px; font-weight:600; background:#333; color:#fff; }
    body.light .toggle-btn{ background:#ddd; color:#111; }

    .row{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
    .subgrid{ display:grid; gap:8px; }
    .pill{ display:flex; gap:8px; background:#444; padding:6px; border-radius:999px; width:max-content; }
    .pill button{ border:0; background:transparent; padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; color:#ddd; }
    .pill button[aria-pressed="true"]{ background:#222; color:#fff; }
    input[type="range"]{ width:100%; }
    .inline{ display:flex; align-items:center; gap:10px; }
    .swatch{ width:28px; height:28px; border-radius:8px; box-shadow: inset 0 0 0 1px rgba(0,0,0,.12); }
    .muted{ color:var(--muted); font-size:.92rem; }
    .credit{ margin-top:8px; font-size:.9rem; opacity:.85; text-align:center; }
    .credit a{ color:inherit; font-weight:700; text-decoration:none; }

    @media (max-width: 700px){
      .panel{ left:20px; right:20px; width:auto; top:auto; bottom:20px; height:min(70vh,520px); transform: translateY(0); }
      .panel.collapsed{ transform: translateY(calc(100% + 24px)); }
      .menu-tab{ top:auto; bottom:24px; right:24px; transform:none; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="frame" id="lampFrame">
      <div class="glass"></div>
      <div class="ribs" id="ribs"></div>
      <div class="grain"></div>
      <div class="glow" id="glow"></div>
    </div>

    <aside class="panel" id="panel">
      <button class="collapse-btn" id="collapseBtn" title="Hide controls">⇢</button>
      <div class="panel-scroll">
        <div class="row">
          <h2>Lamp Controls</h2>
          <button class="toggle-btn" id="themeBtn" aria-pressed="false">Dark Mode</button>
        </div>
        <div class="subgrid">
          <div class="pill" role="tablist" aria-label="Color Mode">
            <button id="modeRGB" role="tab" aria-selected="true" aria-pressed="true">RGB</button>
            <button id="modeWhite" role="tab" aria-selected="false" aria-pressed="false">White</button>
          </div>
          <div id="rgbControls" class="subgrid">
            <div class="row">
              <label for="colorPicker">Color</label>
              <div class="inline"><div class="swatch" id="swatch"></div></div>
            </div>
            <input id="colorPicker" type="color" value="#ffb84f" aria-label="RGB color" />
            <!-- Fallback: RGB sliders (used if color input isn't supported or events are blocked in embedded hosts like iCUE) -->
            <div id="rgbSliders" class="subgrid" style="display:none; margin-top:8px;">
              <div class="row"><label for="rSlider">Red</label><span id="rVal" class="muted">255</span></div>
              <input id="rSlider" type="range" min="0" max="255" value="255" />
              <div class="row"><label for="gSlider">Green</label><span id="gVal" class="muted">184</span></div>
              <input id="gSlider" type="range" min="0" max="255" value="184" />
              <div class="row"><label for="bSlider">Blue</label><span id="bValRGB" class="muted">79</span></div>
              <input id="bSlider" type="range" min="0" max="255" value="79" />
            </div>
          </div>
          <div id="whiteControls" class="subgrid" style="display:none;">
            <div class="row">
              <label for="whiteSlider">White tone</label>
              <span class="muted" id="whiteLabel">Cold</span>
            </div>
            <input id="whiteSlider" type="range" min="0" max="100" value="0" />
            <div class="muted" aria-hidden="true" style="display:flex; justify-content:space-between; font-size:.85rem; margin-top:-4px;">
              <span>Cold</span><span>Warm</span><span>Warmest</span>
            </div>
          </div>
          <div class="row"><label for="brightness">Brightness</label><span id="bVal" class="muted">70</span></div>
          <input id="brightness" type="range" min="0" max="100" value="70" />
          <div class="row"><label for="frost">Frost (ribbing)</label><span id="fVal" class="muted">25%</span></div>
          <input id="frost" type="range" min="0" max="100" value="25" />
          <div class="credit">I Love Lamp by <a href="https://opulent-hardware.github.io/-I-love-lamp/" target="_blank" rel="noreferrer noopener">OPULENT HARDWARE</a></div>
        </div>
      </div>
    </aside>
    <button class="menu-tab" id="menuTab" title="Show controls">☰ Menu</button>
  </div>

  <script>
    const frame=document.getElementById('lampFrame');
    const ribs=document.getElementById('ribs');
    const glow=document.getElementById('glow');
    const panel=document.getElementById('panel');
    const collapseBtn=document.getElementById('collapseBtn');
    const menuTab=document.getElementById('menuTab');
    const themeBtn=document.getElementById('themeBtn');
    const brightness=document.getElementById('brightness');
    const bVal=document.getElementById('bVal');
    const frost=document.getElementById('frost');
    const fVal=document.getElementById('fVal');

    const modeRGB=document.getElementById('modeRGB');
    const modeWhite=document.getElementById('modeWhite');
    const rgbControls=document.getElementById('rgbControls');
    const whiteControls=document.getElementById('whiteControls');

    const colorPicker=document.getElementById('colorPicker');
    const rgbSliders=document.getElementById('rgbSliders');
    const rSlider=document.getElementById('rSlider');
    const gSlider=document.getElementById('gSlider');
    const bSlider=document.getElementById('bSlider');
    const rValTxt=document.getElementById('rVal');
    const gValTxt=document.getElementById('gVal');
    const bValTxt=document.getElementById('bValRGB');

    const swatch=document.getElementById('swatch');
    const whiteSlider=document.getElementById('whiteSlider');
    const whiteLabel=document.getElementById('whiteLabel');

    function setCSSVar(name,value){document.documentElement.style.setProperty(name,value)}
    function hexToRgb(hex){const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return m?{r:parseInt(m[1],16),g:parseInt(m[2],16),b:parseInt(m[3],16)}:{r:255,g:184,b:79}}
    function kelvinToRGB(k){let t=k/100,r,g,b;if(t<=66)r=255;else{r=t-60;r=329.698727446*Math.pow(r,-0.1332047592);r=Math.min(255,Math.max(0,r))}if(t<=66){g=99.4708025861*Math.log(t)-161.1195681661}else{g=t-60;g=288.1221695283*Math.pow(g,-0.0755148492)}g=Math.min(255,Math.max(0,g));if(t>=66)b=255;else if(t<=19)b=0;else{b=138.5177312231*Math.log(t-10)-305.0447927307;b=Math.min(255,Math.max(0,b))}return{r:Math.round(r),g:Math.round(g),b:Math.round(b)}}
    function applyRGB({r,g,b}){setCSSVar('--glow-r',r);setCSSVar('--glow-g',g);setCSSVar('--glow-b',b);swatch.style.background=`rgb(${r},${g},${b})`}
    function applyWhiteFromSlider(v){const k=6500-(4500*(v/100));const {r,g,b}=kelvinToRGB(k);applyRGB({r,g,b});whiteLabel.textContent=v<15?'Cold':(v>85?'Warmest':'Warm')}
    function updateBrightness(v){setCSSVar('--brightness',v);bVal.textContent=v}
    function updateFrost(v){setCSSVar('--rib-opacity',(v/100).toFixed(3));fVal.textContent=v+'%'}
    function updateOrientation(){const rect=frame.getBoundingClientRect();const w=rect.width>=rect.height;const d=w?90:0;setCSSVar('--glow-deg',d+'deg');setCSSVar('--rib-angle',d+'deg')}

    // Orientation observers
    const ro=new ResizeObserver(updateOrientation);ro.observe(frame);
    window.addEventListener('orientationchange',updateOrientation);
    window.addEventListener('load',updateOrientation);

    // Inputs
    brightness.addEventListener('input',e=>updateBrightness(e.target.value));
    frost.addEventListener('input',e=>updateFrost(e.target.value));

    // Color picker: listen to both 'input' and 'change' (embedded hosts often only fire 'change')
    function onColorChange(e){ applyRGB(hexToRgb(e.target.value)); syncSlidersToSwatch(); }
    colorPicker.addEventListener('input', onColorChange);
    colorPicker.addEventListener('change', onColorChange);

    // RGB sliders fallback (no storage used)
    function fromSliders(){
      const r = +rSlider.value, g = +gSlider.value, b = +bSlider.value;
      applyRGB({r,g,b});
      rValTxt.textContent = r; gValTxt.textContent = g; bValTxt.textContent = b;
      colorPicker.value = '#' + [r,g,b].map(v=> v.toString(16).padStart(2,'0')).join('');
    }
    function syncSlidersToSwatch(){
      const {r,g,b} = hexToRgb(colorPicker.value);
      rSlider.value = r; gSlider.value = g; bSlider.value = b;
      rValTxt.textContent = r; gValTxt.textContent = g; bValTxt.textContent = b;
    }
    if (rSlider && gSlider && bSlider){
      rSlider.addEventListener('input', fromSliders);
      gSlider.addEventListener('input', fromSliders);
      bSlider.addEventListener('input', fromSliders);
    }

    // Mode toggle
    function setModeRGB(){
      modeRGB.setAttribute('aria-pressed','true');
      modeWhite.setAttribute('aria-pressed','false');
      rgbControls.style.display='';
      whiteControls.style.display='none';
    }
    function setModeWhite(){
      modeRGB.setAttribute('aria-pressed','false');
      modeWhite.setAttribute('aria-pressed','true');
      rgbControls.style.display='none';
      whiteControls.style.display='';
      applyWhiteFromSlider(+whiteSlider.value);
    }
    modeRGB.addEventListener('click',setModeRGB);
    modeWhite.addEventListener('click',setModeWhite);

    // Theme toggle (default dark)
    themeBtn.addEventListener('click',()=>{
      const isLight=document.body.classList.toggle('light');
      themeBtn.textContent=isLight?'Light Mode':'Dark Mode';
      themeBtn.setAttribute('aria-pressed',String(isLight));
    });

    // Panel collapse
    collapseBtn.addEventListener('click',()=>panel.classList.add('collapsed'));
    menuTab.addEventListener('click',()=>panel.classList.remove('collapsed'));

    // Detect whether input[type=color] is really usable in this host; if not, show slider fallback.
    function ensureUsableColorInput(){
      const probe=document.createElement('input'); probe.type='color';
      const supported = (probe.type === 'color');
      if(!supported && rgbSliders && colorPicker){
        rgbSliders.style.display='';
        colorPicker.style.display='none';
      }
    }

    (function init(){
      updateOrientation();
      updateBrightness(brightness.value);
      updateFrost(frost.value);
      applyRGB(hexToRgb(colorPicker.value));
      setModeRGB();
      ensureUsableColorInput();
      syncSlidersToSwatch();
    })();
  </script>
</body>
</html>
