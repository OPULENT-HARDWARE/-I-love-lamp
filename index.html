<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Frosted Glass Lamp – HTML Widget</title>
  <style>
    :root{
      --glow-r: 255; --glow-g: 184; --glow-b: 79;
      --brightness: 70;
      --rib-opacity: 0.35;
      --glass-tint: 255,255,255; --edge-dark: 24,24,28;
      --noise-opacity:.1; --corner: 28px;
      --bg-color:#121212; --text-color:#e9e9e9; --panel-bg:#1e1e1e;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; margin:0; background:var(--bg-color); color:var(--text-color);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
      transition: background .3s ease, color .3s ease; }
    body.light{ --bg-color:#e9e6e3; --text-color:#1f2328; --panel-bg:#ffffff; }

    /* Page is now a single layer; lamp fills the whole container and the menu overlays. */
    .page{ position:relative; height:100%; padding:20px; }

    /* Lamp completely fills the available frame, regardless of aspect. */
    .frame{ position:absolute; inset:20px; border-radius:var(--corner); overflow:hidden; background:transparent; box-shadow:0 30px 70px rgba(0,0,0,.25); }
    .glass{ position:absolute; inset:0; border-radius:inherit; background:
      radial-gradient(120% 100% at -10% 50%, rgba(var(--edge-dark), .22), transparent 45%),
      radial-gradient(120% 100% at 110% 50%, rgba(var(--edge-dark), .22), transparent 45%),
      linear-gradient(180deg, rgba(var(--glass-tint),.55), rgba(var(--glass-tint),.35)); }
    .ribs{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; background:
      repeating-linear-gradient(var(--rib-angle, 90deg), rgba(255,255,255, calc(var(--rib-opacity)*.35)) 0 1px,
      rgba(200,200,210, calc(var(--rib-opacity)*.35)) 1px 2px, rgba(150,150,160,0) 2px 5px); opacity:.9; }
    .grain{ position:absolute; inset:0; border-radius:inherit; pointer-events:none; }
    .grain::before{ content:""; position:absolute; inset:-50%; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.45"/></svg>'); background-size:300px 300px; opacity:var(--noise-opacity); mix-blend-mode:soft-light; }
    .glow{ position:absolute; inset: clamp(8px, 8%, 60px); border-radius: calc(var(--corner)*.6); filter: blur(calc(1px + (var(--brightness)/100 * 10px)));
      background: radial-gradient(closest-side at 50% 50%, rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/220)), rgba(0,0,0,0) 66%),
                  linear-gradient(var(--glow-deg,0deg), rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/150)) 30%, rgba(0,0,0,0) 72%);
      box-shadow: 0 0 calc(20px + 40px * (var(--brightness)/100)) rgba(var(--glow-r), var(--glow-g), var(--glow-b), calc(var(--brightness)/180)); }
    .glass::after{ content:""; position:absolute; inset:0; border-radius:inherit; background: linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,0) 28%, rgba(0,0,0,.06) 65%, rgba(0,0,0,.18)); mix-blend-mode:screen; opacity:.8; }

    /* Overlay control panel (does NOT consume layout space). */
    .panel{ position:fixed; right:20px; top:20px; bottom:20px; width: clamp(260px, 26vw, 380px); z-index:5;
      background:var(--panel-bg); border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1);
      display:flex; flex-direction:column; padding:14px; gap:12px; transform: translateX(0); transition: transform .35s ease; overflow:hidden; }
    .panel.collapsed{ transform: translateX(calc(100% + 24px)); }

    .panel-scroll{ overflow:auto; padding:6px 2px 10px; }

    .toggle-btn{ cursor:pointer; border:none; border-radius:8px; padding:8px 12px; font-weight:600; background:#333; color:#fff; align-self:flex-end; }
    body.light .toggle-btn{ background:#ddd; color:#111; }

    .collapse-btn{ position:absolute; left:10px; top:10px; border:0; border-radius:8px; padding:6px 10px; font-weight:700; cursor:pointer; background:#2c2c2c; color:#fff; }
    body.light .collapse-btn{ background:#e1e1e1; color:#111; }

    .menu-tab{ position:fixed; right:12px; top:50%; transform:translateY(-50%); border:0; border-radius:12px; padding:10px 12px; font-weight:700; cursor:pointer; background:#2c2c2c; color:#fff; box-shadow:0 8px 20px rgba(0,0,0,.25); display:none; z-index:6; }
    .panel.collapsed + .menu-tab{ display:block; }
    body.light .menu-tab{ background:#e1e1e1; color:#111; }

    .row{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; }
    .subgrid{ display:grid; gap:8px; }
    .pill{ display:flex; gap:8px; background:#444; padding:6px; border-radius:999px; width:max-content; }
    .pill button{ border:0; background:transparent; padding:8px 12px; border-radius:999px; cursor:pointer; font-weight:600; color:#ddd; }
    .pill button[aria-pressed="true"]{ background:#222; color:#fff; }
    input[type="range"]{ width:100%; }
    .inline{ display:flex; align-items:center; gap:10px; }
    .swatch{ width:26px; height:26px; border-radius:8px; box-shadow: inset 0 0 0 1px rgba(0,0,0,.12); }
    .muted{ color:#aaa; font-size:.92rem; }
    .credit{ margin-top:8px; font-size:.9rem; opacity:.85; }
    .credit a{ color:inherit; font-weight:700; text-decoration:none; }

    /* Mobile: dock as a bottom sheet */
    @media (max-width: 700px){
      .panel{ left:20px; right:20px; width:auto; top:auto; bottom:20px; height:min(70vh,520px); transform: translateY(0); }
      .panel.collapsed{ transform: translateY(calc(100% + 24px)); }
      .menu-tab{ top:auto; bottom:24px; right:24px; transform:none; }
    }
  </style>
</head>
<body>
  <div class="page">
    <div class="frame" id="lampFrame">
      <div class="glass"></div>
      <div class="ribs" id="ribs"></div>
      <div class="grain"></div>
      <div class="glow" id="glow"></div>
    </div>

    <aside class="panel" id="panel" aria-label="Controls">
      <button id="collapse" class="collapse-btn" title="Hide controls">⇢</button>
      <div class="panel-scroll">
        <button id="themeToggle" class="toggle-btn">☾ Dark Mode</button>
        <h2 style="margin:0 0 6px">Lamp Controls</h2>

        <div class="row"><label for="brightness"><strong>Brightness</strong></label><div class="inline"><span id="bVal" class="muted">70</span></div></div>
        <input id="brightness" type="range" min="0" max="100" value="70" />

        <div class="subgrid">
          <div class="pill" role="tablist"><button id="modeRGB" aria-pressed="true">RGB</button><button id="modeWhite" aria-pressed="false">White</button></div>
          <div id="rgbControls"><div class="row"><label for="rgb">Color</label><div class="inline"><div id="swatch" class="swatch" style="background: rgb(255,184,79);"></div></div></div><input id="rgb" type="color" value="#ffb84f" /></div>
          <div id="whiteControls" style="display:none"><div class="row"><label for="cct">White (Cold → Warmest)</label><div class="inline"><span id="cctLabel" class="muted">3500K</span></div></div><input id="cct" type="range" min="0" max="100" value="50" /></div>
        </div>

        <div class="row"><label for="ribbing">Frost Ribbing</label><div class="inline"><span id="ribVal" class="muted">35%</span></div></div>
        <input id="ribbing" type="range" min="0" max="100" value="35" />

        <p class="credit">I Love Lamp by <a href="https://opulent-hardware.github.io/-I-love-lamp/" target="_blank" rel="noopener">OPULENT HARDWARE</a></p>
      </div>
    </aside>
    <button class="menu-tab" id="menuTab" title="Show controls">☰ Menu</button>
  </div>

  <script>
    const frame = document.getElementById('lampFrame');
    const b = document.getElementById('brightness');
    const bVal = document.getElementById('bVal');
    const rgb = document.getElementById('rgb');
    const swatch = document.getElementById('swatch');
    const cct = document.getElementById('cct');
    const cctLabel = document.getElementById('cctLabel');
    const modeRGB = document.getElementById('modeRGB');
    const modeWhite = document.getElementById('modeWhite');
    const rgbControls = document.getElementById('rgbControls');
    const whiteControls = document.getElementById('whiteControls');
    const ribs = document.getElementById('ribs');
    const ribbing = document.getElementById('ribbing');
    const ribVal = document.getElementById('ribVal');
    const themeToggle = document.getElementById('themeToggle');
    const panel = document.getElementById('panel');
    const collapseBtn = document.getElementById('collapse');
    const menuTab = document.getElementById('menuTab');

    const css = (prop, val) => document.documentElement.style.setProperty(prop, val);
    function hexToRgb(hex){ const v = hex.replace('#',''); return [parseInt(v.slice(0,2),16), parseInt(v.slice(2,4),16), parseInt(v.slice(4,6),16)]; }
    function lerpColor(a,b,t){ return [Math.round(a[0]+(b[0]-a[0])*t), Math.round(a[1]+(b[1]-a[1])*t), Math.round(a[2]+(b[2]-a[2])*t)]; }
    function cctToRgb(p){ const cold=[180,200,255], neutral=[255,244,229], warm=[255,180,60]; return p<.5?lerpColor(cold,neutral,p/.5):lerpColor(neutral,warm,(p-.5)/.5); }

    function updateBrightness(){ css('--brightness', b.value); bVal.textContent = b.value; }
    function setRgb([r,g,b]){ css('--glow-r', r); css('--glow-g', g); css('--glow-b', b); swatch.style.background = `rgb(${r},${g},${b})`; }
    function handleRgbChange(){ setRgb(hexToRgb(rgb.value)); }
    function handleCctChange(){ const p = +cct.value/100; const [r,g,bb] = cctToRgb(p); setRgb([r,g,bb]); const temp = Math.round(6500-(6500-1800)*p); cctLabel.textContent = temp+'K'; }

    function setMode(which){ const rgbMode = which==='rgb'; rgbControls.style.display = rgbMode?'block':'none'; whiteControls.style.display = rgbMode?'none':'block'; modeRGB.setAttribute('aria-pressed', rgbMode); modeWhite.setAttribute('aria-pressed', !rgbMode); if(rgbMode) handleRgbChange(); else handleCctChange(); }

    function updateOrientation(){ const rect = frame.getBoundingClientRect(); const longIsHorizontal = rect.width >= rect.height; css('--glow-deg', longIsHorizontal?'90deg':'0deg'); ribs.style.setProperty('--rib-angle', longIsHorizontal?'0deg':'90deg'); }
    function updateRibbing(){ const value = ribbing.value; css('--rib-opacity', (value/100).toFixed(2)); ribVal.textContent = value+'%'; }

    // Theme toggle
    themeToggle.addEventListener('click', ()=>{ document.body.classList.toggle('light'); themeToggle.textContent = document.body.classList.contains('light') ? '☀ Light Mode' : '☾ Dark Mode'; });

    // Collapsible overlay
    const collapse = ()=> panel.classList.add('collapsed');
    const expand = ()=> panel.classList.remove('collapsed');
    collapseBtn.addEventListener('click', collapse);
    menuTab.addEventListener('click', expand);

    // React to size
    const ro = new ResizeObserver(updateOrientation); ro.observe(frame); window.addEventListener('resize', updateOrientation);

    // Init
    updateBrightness(); handleRgbChange(); updateOrientation(); updateRibbing();
  </script>
</body>
</html>
