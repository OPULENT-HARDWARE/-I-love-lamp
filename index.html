<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>I Love Lamp – Soft Rectangular Fade (RGB Fixed)</title>
<style>
  :root{
    --glow-r:255; --glow-g:184; --glow-b:79;
    --brightness:74;              /* 0–100 */
    --glow-deg:90deg;             /* oriented beam */
    --rib-opacity:.22;            /* frost */
    --rib-angle:90deg;
    --bg-color:#121212; --text-color:#e9e9e9; --panel-bg:#1e1e1e; --muted:#b7b7b7;
    --edge-dark:24,24,28; --glass-tint:255,255,255;
    --noise-opacity:.08; --corner:28px;

    /* White-mode luminance multiplier */
    --white-boost:1;

    /* Lamp padding (tight so glow fills) */
    --pad: clamp(2px, 2vmin, 24px);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:var(--bg-color); color:var(--text-color);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial;
    transition: background .3s ease, color .3s ease;
  }
  body.light{ --bg-color:#e9e6e3; --text-color:#1f2328; --panel-bg:#ffffff; --muted:#59636e; }

  .page{position:relative;height:100%}
  .frame{position:absolute;inset:0;border-radius:var(--corner);overflow:hidden;background:transparent}

  /* Subtle cylindrical body & edge depth */
  .glass{
    position:absolute;inset:0;border-radius:inherit;
    background:
      linear-gradient(90deg, rgba(0,0,0,.16), transparent 18%, transparent 82%, rgba(0,0,0,.16)),
      linear-gradient(180deg, rgba(255,255,255,.22), rgba(255,255,255,0) 28%, rgba(0,0,0,.08) 72%, rgba(0,0,0,.14)),
      radial-gradient(120% 100% at -10% 50%, rgba(var(--edge-dark),.2), transparent 46%),
      radial-gradient(120% 100% at 110% 50%, rgba(var(--edge-dark),.2), transparent 46%),
      linear-gradient(180deg, rgba(var(--glass-tint),.46), rgba(var(--glass-tint),.34));
  }

  .ribs{position:absolute;inset:0;border-radius:inherit;pointer-events:none;background:
    repeating-linear-gradient(var(--rib-angle),
      rgba(255,255,255, calc(var(--rib-opacity)*.32)) 0 1px,
      rgba(200,200,210, calc(var(--rib-opacity)*.32)) 1px 2px,
      rgba(150,150,160,0) 2px 5px); opacity:.9}

  .grain{position:absolute;inset:0;border-radius:inherit;pointer-events:none}
  .grain::before{content:"";position:absolute;inset:-50%;
    background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 300 300"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="2" stitchTiles="stitch"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.45"/></svg>');
    background-size:300px 300px;opacity:var(--noise-opacity);mix-blend-mode:soft-light;}

  /* Emitter container (holds glow + feather) */
  .emitter{position:absolute;inset:var(--pad);border-radius:calc(var(--corner)*.55);}

  /* Bigger, brighter glow (vibrant core + halo + oriented beam) */
  .glow{position:absolute;inset:0;border-radius:inherit;
    filter: blur(calc(13px + (var(--brightness)/100 * 28px)));
    background:
      radial-gradient(120% 120% at 50% 50%,
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/42)*var(--white-boost))) 0%,
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/56)*var(--white-boost))) 78%,
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/90)*var(--white-boost))) 92%,
        rgba(var(--glow-r),var(--glow-g),var(--glow-b),0) 100%),
      radial-gradient(160% 160% at 50% 50%,
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/140)*var(--white-boost))) 0%,
        rgba(0,0,0,0) 72%),
      linear-gradient(var(--glow-deg),
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/190)*var(--white-boost))) 42%,
        rgba(0,0,0,0) 64%);
    box-shadow:
      0 0 calc(60px + 110px*(var(--brightness)/100))
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/72)*var(--white-boost))),
      0 0 calc(160px + 220px*(var(--brightness)/100))
        rgba(var(--glow-r),var(--glow-g),var(--glow-b), calc((var(--brightness)/190)*var(--white-boost)));
    mix-blend-mode:screen;
  }

  /* Soft rectangular feather: only edges darken gently.
     Built from two long-easing linear-gradients and multiplied on top. */
  .feather{position:absolute;inset:0;border-radius:inherit;pointer-events:none;
    background:
      /* Left + Right (ease with multiple stops) */
      linear-gradient(to right,
        rgba(0,0,0,.26) 0%,
        rgba(0,0,0,.16) 3%,
        rgba(0,0,0,.08) 8%,
        rgba(0,0,0,.03) 13%,
        rgba(0,0,0,0) 22%,
        rgba(0,0,0,0) 78%,
        rgba(0,0,0,.03) 87%,
        rgba(0,0,0,.08) 92%,
        rgba(0,0,0,.16) 97%,
        rgba(0,0,0,.26) 100%),
      /* Top + Bottom */
      linear-gradient(to bottom,
        rgba(0,0,0,.26) 0%,
        rgba(0,0,0,.16) 4%,
        rgba(0,0,0,.08) 9%,
        rgba(0,0,0,.03) 14%,
        rgba(0,0,0,0) 23%,
        rgba(0,0,0,0) 77%,
        rgba(0,0,0,.03) 86%,
        rgba(0,0,0,.08) 91%,
        rgba(0,0,0,.16) 96%,
        rgba(0,0,0,.26) 100%);
    mix-blend-mode:multiply;
  }

  /* ===== Panel / Controls ===== */
  .panel{position:fixed;right:20px;top:20px;bottom:20px;width: clamp(260px,26vw,380px);z-index:5;
    background:var(--panel-bg);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.1);
    display:flex;flex-direction:column;padding:14px;gap:12px;transform:translateX(0);transition:transform .35s ease;overflow:hidden}
  .panel h2{margin-left:28px}
  .panel.collapsed{transform:translateX(calc(100% + 24px))}
  .panel-scroll{overflow:auto;padding:6px 2px 10px}
  .collapse-btn{position:absolute;left:10px;top:10px;border:0;border-radius:8px;padding:6px 10px;font-weight:700;cursor:pointer;background:#2c2c2c;color:#fff;z-index:10}
  .menu-tab{position:fixed;right:12px;top:50%;transform:translateY(-50%);border:0;border-radius:12px;padding:10px 12px;font-weight:700;cursor:pointer;background:#2c2c2c;color:#fff;box-shadow:0 8px 20px rgba(0,0,0,.25);display:none;z-index:6}
  .panel.collapsed + .menu-tab{display:block}
  .toggle-btn{cursor:pointer;border:none;border-radius:8px;padding:8px 12px;font-weight:600;background:#333;color:#fff}
  .row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  .subgrid{display:grid;gap:8px}
  .pill{display:flex;gap:8px;background:#444;padding:6px;border-radius:999px;width:max-content}
  .pill button{border:0;background:transparent;padding:8px 12px;border-radius:999px;cursor:pointer;font-weight:600;color:#ddd}
  .pill button[aria-pressed="true"]{background:#222;color:#fff}
  input[type="range"]{width:100%}
  .inline{display:flex;align-items:center;gap:10px}
  .swatch{width:28px;height:28px;border-radius:8px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.12)}
  .muted{color:var(--muted);font-size:.92rem}
  .credit{margin-top:8px;font-size:.9rem;opacity:.85;text-align:center}
  .credit a{color:inherit;font-weight:700;text-decoration:none}

  /* Simple click-only RGB UI */
  .hue-row{display:grid;grid-template-columns:repeat(12,1fr);gap:6px}
  .hue-btn{height:24px;border-radius:8px;border:0;cursor:pointer}
  .hue-btn[aria-pressed="true"]{outline:2px solid #fff;outline-offset:2px}
  .sv-board{position:relative;width:100%;aspect-ratio:4/3;border-radius:10px;overflow:hidden;box-shadow:inset 0 0 0 1px rgba(0,0,0,.2);cursor:pointer}
  .sv-base{position:absolute;inset:0}
  .sv-white{position:absolute;inset:0;background:linear-gradient(90deg,#fff,rgba(255,255,255,0))}
  .sv-black{position:absolute;inset:0;background:linear-gradient(0deg,#000,rgba(0,0,0,0))}
  .sv-dot{position:absolute;width:14px;height:14px;border-radius:50%;border:2px solid #fff;box-shadow:0 0 0 1px rgba(0,0,0,.5);transform:translate(-50%,-50%);pointer-events:none}

  @media (max-width:700px){
    .panel{left:20px;right:20px;width:auto;top:auto;bottom:20px;height:min(70vh,520px);transform:translateY(0)}
    .panel.collapsed{transform:translateY(calc(100% + 24px))}
    .menu-tab{top:auto;bottom:24px;right:24px;transform:none}
  }
</style>
</head>
<body>
  <div class="page">
    <div class="frame" id="lampFrame" aria-label="Frosted glass lamp">
      <div class="glass"></div>
      <div class="ribs" id="ribs"></div>
      <div class="grain"></div>

      <div class="emitter">
        <div class="glow" id="glow"></div>
        <div class="feather" aria-hidden="true"></div>
      </div>
    </div>

    <!-- Controls -->
    <aside class="panel" id="panel">
      <button class="collapse-btn" id="collapseBtn" title="Hide controls">⇢</button>
      <div class="panel-scroll">
        <div class="row">
          <h2>Lamp Controls</h2>
          <button class="toggle-btn" id="themeBtn" aria-pressed="false">Dark Mode</button>
        </div>

        <div class="subgrid" style="margin-top:6px;">
          <div class="pill" role="tablist" aria-label="Color Mode">
            <button id="modeRGB" role="tab" aria-selected="true" aria-pressed="true">RGB</button>
            <button id="modeWhite" role="tab" aria-selected="false" aria-pressed="false">White</button>
          </div>

          <!-- RGB: click-only -->
          <div id="rgbControls" class="subgrid">
            <div class="row">
              <label>Color</label>
              <div class="inline"><div class="swatch" id="swatch"></div></div>
            </div>
            <div class="hue-row" id="hueRow" aria-label="Hue presets"></div>
            <div class="sv-board" id="svBoard" aria-label="Click to set Saturation/Value">
              <div class="sv-base" id="svBase"></div>
              <div class="sv-white"></div>
              <div class="sv-black"></div>
              <div class="sv-dot" id="svDot"></div>
            </div>
          </div>

          <!-- White mode -->
          <div id="whiteControls" class="subgrid" style="display:none;">
            <div class="row">
              <label for="whiteSlider">White tone</label>
              <span class="muted" id="whiteLabel">Cold</span>
            </div>
            <input id="whiteSlider" type="range" min="0" max="100" value="0" />
            <div class="muted" aria-hidden="true" style="display:flex;justify-content:space-between;font-size:.85rem;margin-top:-4px;">
              <span>Cold</span><span>Warm</span><span>Warmest</span>
            </div>
          </div>

          <div class="row" style="margin-top:6px;">
            <label for="brightness">Brightness</label>
            <span id="bVal" class="muted">74</span>
          </div>
          <input id="brightness" type="range" min="0" max="100" value="74" />

          <div class="row" style="margin-top:6px;">
            <label for="frost">Frost (ribbing)</label>
            <span id="fVal" class="muted">22%</span>
          </div>
          <input id="frost" type="range" min="0" max="100" value="22" />

          <div class="credit">I Love Lamp by
            <a href="https://opulent-hardware.github.io/-I-love-lamp/" target="_blank" rel="noreferrer noopener">OPULENT HARDWARE</a>
          </div>
        </div>
      </div>
    </aside>
    <button class="menu-tab" id="menuTab" title="Show controls">☰ Menu</button>
  </div>

<script>
  /* Utilities */
  const setCSSVar=(n,v)=>document.documentElement.style.setProperty(n,v);
  const clamp=(v,a,b)=>Math.min(b,Math.max(a,v));
  function hsvToRgb(h,s,v){
    s/=100; v/=100;
    const c=v*s,x=c*(1-Math.abs(((h/60)%2)-1)),m=v-c;
    let r=0,g=0,b=0;
    if(h<60){r=c;g=x;b=0}else if(h<120){r=x;g=c;b=0}
    else if(h<180){r=0;g=c;b=x}else if(h<240){r=0;g=x;b=c}
    else if(h<300){r=x;g=0;b=c}else{r=c;g=0;b=x}
    return {r:Math.round((r+m)*255),g:Math.round((g+m)*255),b:Math.round((b+m)*255)};
  }
  function kelvinToRGB(k){
    let t=k/100,r,g,b;
    if(t<=66) r=255; else { r=t-60; r=329.698727446*Math.pow(r,-0.1332047592); r=Math.min(255,Math.max(0,r)); }
    if(t<=66){ g=99.4708025861*Math.log(t)-161.1195681661; }
    else { g=t-60; g=288.1221695283*Math.pow(g,-0.0755148492); }
    g=Math.min(255,Math.max(0,g));
    if(t>=66) b=255; else if(t<=19) b=0; else { b=138.5177312231*Math.log(t-10)-305.0447927307; b=Math.min(255,Math.max(0,b)); }
    return {r:Math.round(r),g:Math.round(g),b:Math.round(b)};
  }
  function applyRGB({r,g,b}){ setCSSVar('--glow-r',r); setCSSVar('--glow-g',g); setCSSVar('--glow-b',b); swatch.style.background=`rgb(${r},${g},${b})`; }

  /* DOM refs */
  const frame=document.getElementById('lampFrame');
  const panel=document.getElementById('panel');
  const collapseBtn=document.getElementById('collapseBtn');
  const menuTab=document.getElementById('menuTab');
  const themeBtn=document.getElementById('themeBtn');

  const modeRGB=document.getElementById('modeRGB');
  const modeWhite=document.getElementById('modeWhite');   /* <-- FIXED: properly declared */
  const rgbControls=document.getElementById('rgbControls');
  const whiteControls=document.getElementById('whiteControls');

  const swatch=document.getElementById('swatch');
  const whiteSlider=document.getElementById('whiteSlider');
  const whiteLabel=document.getElementById('whiteLabel');

  const brightness=document.getElementById('brightness');
  const bVal=document.getElementById('bVal');
  const frost=document.getElementById('frost');
  const fVal=document.getElementById('fVal');

  const hueRow=document.getElementById('hueRow');
  const svBoard=document.getElementById('svBoard');
  const svBase=document.getElementById('svBase');
  const svDot=document.getElementById('svDot');

  /* RGB click-only picker */
  let H=40,S=60,V=90;
  function buildHueButtons(){
    const steps=[0,30,60,90,120,150,180,210,240,270,300,330];
    hueRow.innerHTML='';
    steps.forEach(h=>{
      const {r,g,b}=hsvToRgb(h,100,100);
      const btn=document.createElement('button');
      btn.className='hue-btn'; btn.style.background=`rgb(${r},${g},${b})`;
      btn.setAttribute('aria-pressed', h===H ? 'true':'false');
      btn.title=`Hue ${h}°`;
      btn.addEventListener('click',()=>{
        H=h; [...hueRow.children].forEach(b=>b.setAttribute('aria-pressed','false'));
        btn.setAttribute('aria-pressed','true'); paintFromHSV();
      });
      hueRow.appendChild(btn);
    });
  }
  function paintSVBase(){ const {r,g,b}=hsvToRgb(H,100,100); svBase.style.background=`rgb(${r},${g},${b})`; }
  function setDot(){ const r=svBoard.getBoundingClientRect(); svDot.style.left=(S/100*r.width)+'px'; svDot.style.top=((100-V)/100*r.height)+'px'; }
  function paintFromHSV(){ paintSVBase(); applyRGB(hsvToRgb(H,S,V)); setDot(); }
  svBoard.addEventListener('click',e=>{
    const r=svBoard.getBoundingClientRect();
    S=Math.round((clamp(e.clientX-r.left,0,r.width)/r.width)*100);
    V=Math.round(100-(clamp(e.clientY-r.top,0,r.height)/r.height)*100);
    paintFromHSV();
  });

  /* Modes */
  function setModeRGB(){
    modeRGB.setAttribute('aria-pressed','true'); modeWhite.setAttribute('aria-pressed','false');
    rgbControls.style.display=''; whiteControls.style.display='none';
    setCSSVar('--white-boost',1); paintFromHSV();
  }
  function setModeWhite(){
    modeRGB.setAttribute('aria-pressed','false'); modeWhite.setAttribute('aria-pressed','true');
    rgbControls.style.display='none'; whiteControls.style.display='';
    setCSSVar('--white-boost',3.6); applyWhite(+whiteSlider.value);
  }
  function applyWhite(v){
    const k=6500-(4500*(v/100)); const {r,g,b}=kelvinToRGB(k);
    applyRGB({r,g,b}); whiteLabel.textContent=v<15?'Cold':(v>85?'Warmest':'Warm');
  }
  whiteSlider.addEventListener('input',e=>applyWhite(+e.target.value));
  modeRGB.addEventListener('click',setModeRGB);
  modeWhite.addEventListener('click',setModeWhite);

  /* Brightness/Frost/Orientation */
  function updateBrightness(v){ setCSSVar('--brightness',v); bVal.textContent=v; }
  function updateFrost(v){ setCSSVar('--rib-opacity',(v/100).toFixed(3)); fVal.textContent=v+'%'; }
  function updateOrientation(){
    const r=frame.getBoundingClientRect(); const deg=(r.width>=r.height)?90:0;
    setCSSVar('--glow-deg',deg+'deg'); setCSSVar('--rib-angle',deg+'deg');
  }
  const ro=new ResizeObserver(updateOrientation); ro.observe(frame);
  window.addEventListener('orientationchange',updateOrientation);
  window.addEventListener('load',updateOrientation);
  brightness.addEventListener('input',e=>updateBrightness(e.target.value));
  frost.addEventListener('input',e=>updateFrost(e.target.value));

  /* Theme & panel */
  themeBtn.addEventListener('click',()=>{
    const isLight=document.body.classList.toggle('light');
    themeBtn.textContent=isLight?'Light Mode':'Dark Mode';
    themeBtn.setAttribute('aria-pressed',String(isLight));
  });
  collapseBtn.addEventListener('click',()=>panel.classList.add('collapsed'));
  menuTab.addEventListener('click',()=>panel.classList.remove('collapsed'));

  /* Init */
  (function init(){
    updateOrientation(); updateBrightness(brightness.value); updateFrost(frost.value);
    buildHueButtons(); paintFromHSV(); setModeRGB(); // default
  })();
</script>
</body>
</html>
